#!/bin/bash
# Simplified pre-commit hook for CloudWorkstation  
# Only runs fast formatting checks (< 5 seconds)
# Heavy checks (lint, tests) moved to make targets run before push

set -e

echo "⚡ Running fast pre-commit checks..."

# Colors for output
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Check if we have Go files in the commit
if git diff --cached --name-only | grep -q '\.go$'; then
    echo "📝 Auto-formatting Go files..."
    
    # Auto-format Go files (gofmt + goimports)
    go fmt ./...
    
    if command -v goimports &> /dev/null; then
        goimports -w .
    fi
    
    # Auto-tidy go.mod
    go mod tidy
    
    # Re-add auto-formatted files
    git add -u
    
    echo "✅ Go files auto-formatted"
fi

echo -e "${GREEN}✅ Fast checks complete! (< 5 sec)${NC}"
echo -e "${YELLOW}💡 Before pushing, run:${NC}"
echo -e "${YELLOW}   make lint       # Go Report Card linting${NC}"
echo -e "${YELLOW}   make test-unit  # Unit tests${NC}"
echo -e "${YELLOW}   make test-smoke # Critical path tests${NC}"
