name: "Rocky Linux 9 + Conda Stack"
description: "Rocky Linux 9 base with Conda data science stack - demonstrates template stacking"
base: "ubuntu-22.04"

# Inherit from the Rocky base and add conda
inherits:
  - "Rocky Linux 9 Base"

# Override package manager to conda (stacking conda on top of base system)
package_manager: "conda"

# Add conda packages on top of base system packages
packages:
  conda:
    - "python=3.11"
    - "jupyter"
    - "numpy"
    - "pandas"
    - "matplotlib"
    - "scikit-learn"
  pip:
    - "plotly"

# Add additional user (combines with rocky user from base)
users:
  - name: "datascientist"
    groups: ["sudo"]

# Add services on top of base
services:
  - name: "jupyter"
    port: 8888
    enable: true

# Extend ports from base template
instance_defaults:
  ports: [8888]  # Will be merged with base ports [22]

# Post-install script combining both environments
post_install: |
  # Setup conda for both users
  echo 'conda activate base' >> /home/rocky/.bashrc
  echo 'conda activate base' >> /home/datascientist/.bashrc
  
  # Install additional scientific tools
  /opt/miniforge/bin/conda install -y ipywidgets

version: "1.0"
tags:
  type: "stacked"
  os: "rocky-linux"
  stack: "conda"
  purpose: "data-science"
  parent: "Rocky Linux 9 Base"