name: "Ubuntu Research Server"
description: "Ubuntu 22.04 research server with Docker, development tools, and system administration packages"
base: "ubuntu-22.04"

# Use APT package manager (native for Ubuntu/Debian)
package_manager: "apt"

packages:
  system:  # Research server packages (APT equivalent)
    - "build-essential"
    - "curl"
    - "wget"
    - "git"
    - "vim"
    - "nano"
    - "htop"
    - "tree"
    - "unzip"
    - "software-properties-common"
    - "openssl"
    - "ca-certificates"
    # Container runtime
    - "docker.io"
    - "docker-compose"
    # System administration tools  
    - "rsyslog"
    - "chrony"
    - "ufw"
    # Development tools
    - "nodejs"
    - "npm"
    - "python3"
    - "python3-pip"
    - "openjdk-17-jdk"

users:
  - name: "ubuntu"
    groups: ["sudo", "docker"]

services:
  - name: "docker"
    enable: true
  - name: "chrony"
    enable: true
  - name: "rsyslog"
    enable: true

# Post-install script for research server setup
post_install: |
  # Configure UFW firewall for basic services
  ufw allow ssh
  ufw allow http
  ufw allow https
  ufw --force enable
  
  # Set up time synchronization
  timedatectl set-ntp true
  
  # Configure Docker group
  usermod -aG docker ubuntu
  
  # Set up system logging
  echo "Setting up system logging configuration..."
  echo "LogLevel INFO" >> /etc/ssh/sshd_config

# Idle detection configuration for hibernation support
idle_detection:
  enabled: true
  idle_threshold_minutes: 20
  hibernate_threshold_minutes: 60
  check_interval_minutes: 5

instance_defaults:
  ports: [22, 80, 443, 8080]

version: "1.0"
tags:
  type: "research-server"
  os: "ubuntu"
  purpose: "server"
  security: "apparmor"