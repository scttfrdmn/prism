{"version":3,"file":"use-drag-handle-interaction-state.js","sourceRoot":"","sources":["../../../../../../src/internal/components/drag-handle/hooks/use-drag-handle-interaction-state.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nimport React from 'react';\nimport { useEffect, useReducer, useRef } from 'react';\n\nimport type {\n  Action,\n  DragHandleInteractionState,\n  StateTransitionCallbacks,\n  UseDragHandleInteractionStateProps,\n} from './interfaces';\n\nexport { UseDragHandleInteractionStateProps };\n\nexport function calculateNextState<T = void>(\n  state: DragHandleInteractionState<T>,\n  action: Action<T>\n): DragHandleInteractionState<T> {\n  switch (action.type) {\n    case 'POINTER_DOWN': {\n      const { nativeEvent, metadata } = action.payload;\n      return {\n        value: 'dnd-start',\n        eventData: nativeEvent,\n        metadata,\n      };\n    }\n\n    case 'POINTER_MOVE': {\n      const { nativeEvent } = action.payload;\n      if (state.value === 'dnd-start' || state.value === 'dnd-active') {\n        return {\n          ...state,\n          value: 'dnd-active',\n          eventData: nativeEvent,\n        };\n      }\n      return state;\n    }\n\n    case 'POINTER_UP': {\n      if (state.value === 'dnd-start' || state.value === 'dnd-active') {\n        const dndSubStateBeforeUp = state.value;\n        if (dndSubStateBeforeUp === 'dnd-start') {\n          return {\n            value: 'uap-action-start',\n            metadata: state.metadata, // Preserve metadata when transitioning from dnd-start to uap-action-start\n          };\n        } else {\n          return {\n            value: 'dnd-end',\n            eventData: state.eventData,\n          };\n        }\n      }\n      return state;\n    }\n\n    case 'POINTER_CANCEL': {\n      if (state.value === 'dnd-start' || state.value === 'dnd-active') {\n        return {\n          value: 'dnd-end',\n        };\n      }\n      return state;\n    }\n\n    case 'KEY_DOWN': {\n      const { key, metadata } = action.payload;\n\n      if (key === 'Enter' || key === ' ') {\n        if (state.value === null || state.value === 'uap-action-end' || state.value === 'dnd-end') {\n          return {\n            value: 'uap-action-start',\n            metadata,\n          };\n        } else if (state.value === 'uap-action-start') {\n          return {\n            value: 'uap-action-end',\n          };\n        } else if (state.value === 'dnd-start' || state.value === 'dnd-active') {\n          return {\n            value: 'uap-action-start',\n            metadata,\n          };\n        }\n      } else if (key === 'Escape') {\n        if (state.value === 'uap-action-start') {\n          return {\n            value: 'uap-action-end',\n          };\n        }\n      }\n      return state;\n    }\n\n    case 'FOCUS':\n      return state;\n\n    case 'BLUR':\n      if (state.value === 'uap-action-start') {\n        return {\n          value: 'uap-action-end',\n        };\n      }\n      return state;\n\n    default:\n      throw new Error(`The given action type [${action.type}] is not supported.`);\n  }\n}\n\nexport function getCallbacksForTransition<T = void>(\n  prevState: DragHandleInteractionState<T>,\n  nextState: DragHandleInteractionState<T>\n): StateTransitionCallbacks<T>[] {\n  const callbacks: StateTransitionCallbacks<T>[] = [];\n\n  // Transitions from dnd-start or dnd-active to any other state\n  if (\n    (prevState.value === 'dnd-start' || prevState.value === 'dnd-active') &&\n    nextState.value !== 'dnd-start' &&\n    nextState.value !== 'dnd-active'\n  ) {\n    callbacks.push({ type: 'onDndEnd' });\n  }\n\n  // From uap-action-start to uap-action-end directly\n  if (prevState.value === 'uap-action-start' && nextState.value === 'uap-action-end') {\n    callbacks.push({ type: 'onUapActionEnd' });\n  }\n\n  // Transitions to dnd-start\n  if (nextState.value === 'dnd-start') {\n    callbacks.push({\n      type: 'onDndStart',\n      payload: nextState.eventData!,\n      metadata: nextState.metadata,\n    });\n  }\n\n  // Transitions to dnd-active\n  if (nextState.value === 'dnd-active' && prevState.value === 'dnd-start') {\n    callbacks.push({\n      type: 'onDndActive',\n      payload: nextState.eventData!,\n    });\n  }\n\n  // Transitions to uap-action-start\n  if (nextState.value === 'uap-action-start') {\n    callbacks.push({\n      type: 'onUapActionStart',\n      metadata: nextState.metadata,\n    });\n  }\n\n  return callbacks;\n}\n\nfunction interactionReducer<T = void>(\n  state: DragHandleInteractionState<T>,\n  action: Action<T>\n): DragHandleInteractionState<T> {\n  if (action.type === 'CLEAR_CALLBACKS') {\n    return {\n      ...state,\n      transitionCallbacks: undefined,\n    };\n  }\n\n  const nextState = calculateNextState(state, action);\n\n  // Special handling for POINTER_MOVE to always trigger onDndActive callback\n  if (action.type === 'POINTER_MOVE' && action.payload.nativeEvent) {\n    const transitionCallbacks = getCallbacksForTransition(state, nextState);\n    // Check if there's already an onDndActive callback from the transition\n    const hasOnDndActiveCallback = transitionCallbacks.some(callback => callback.type === 'onDndActive');\n    const callbacks = hasOnDndActiveCallback\n      ? transitionCallbacks\n      : [...transitionCallbacks, { type: 'onDndActive' as const, payload: action.payload.nativeEvent }];\n\n    return {\n      ...nextState,\n      transitionCallbacks: callbacks,\n    };\n  }\n\n  // Return current state if state didn't change\n  const isDndState = (state: DragHandleInteractionState<T>) => {\n    return state.value === 'dnd-start' || state.value === 'dnd-active' || state.value === 'dnd-end';\n  };\n  if (nextState.value === state.value) {\n    if (isDndState(nextState) && isDndState(state)) {\n      if (nextState.eventData === state.eventData) {\n        return state;\n      }\n    } else {\n      return state;\n    }\n  }\n\n  const callbacks = getCallbacksForTransition(state, nextState);\n  return {\n    ...nextState,\n    transitionCallbacks: callbacks.length > 0 ? callbacks : undefined,\n  };\n}\n\nfunction useStateLogger<T = void>(state: DragHandleInteractionState<T>, isEnabled: boolean) {\n  const prevStateRef = useRef<DragHandleInteractionState<T>>(state);\n  useEffect(() => {\n    if (state.value !== prevStateRef.current.value && isEnabled) {\n      console.log(`State transition: ${prevStateRef.current.value} -> ${state.value}`, {\n        prevState: prevStateRef.current,\n        nextState: state,\n      });\n    }\n    prevStateRef.current = state;\n  }, [state, isEnabled]);\n}\n\nfunction useCallbackHandler<T = void>(\n  pendingCallbacks: StateTransitionCallbacks<T>[] | undefined,\n  props: UseDragHandleInteractionStateProps<T>,\n  dispatch: React.Dispatch<Action<T>>\n) {\n  useEffect(() => {\n    if (!pendingCallbacks?.length) {\n      return;\n    }\n    pendingCallbacks.forEach(callback => {\n      switch (callback.type) {\n        case 'onDndStart':\n          props.onDndStartAction?.(callback.payload, callback.metadata);\n          break;\n        case 'onDndActive':\n          props.onDndActiveAction?.(callback.payload);\n          break;\n        case 'onDndEnd':\n          props.onDndEndAction?.();\n          break;\n        case 'onUapActionStart':\n          props.onUapActionStartAction?.(callback.metadata);\n          break;\n        case 'onUapActionEnd':\n          props.onUapActionEndAction?.();\n          break;\n      }\n    });\n\n    // Clean up callbacks to prevent re-execution on subsequent re-renders.\n    dispatch({ type: 'CLEAR_CALLBACKS' });\n  }, [pendingCallbacks, props, dispatch]);\n}\n\n/**\n * Manages interaction states for drag handle components.\n *\n * The hook implements a state machine for drag handles that supports:\n * - Pointer-based drag-and-drop (DnD) interactions\n * - Keyboard-based universal access pattern (UAP) interactions\n * - State transitions with appropriate callbacks\n * - Metadata passing between states\n *\n * States:\n * - null: Idle state with no active interaction\n * - dnd-start: Initial pointer down, beginning of potential drag\n * - dnd-active: Active dragging with pointer movement\n * - dnd-end: Completed drag operation\n * - uap-action-start: Keyboard/accessibility action initiated\n * - uap-action-end: Keyboard/accessibility action completed\n */\nexport default function useDragHandleInteractionState<T = void>(\n  props: UseDragHandleInteractionStateProps<T> = {},\n  options = { debug: false }\n) {\n  const propsRef = useRef<UseDragHandleInteractionStateProps<T>>(props);\n  propsRef.current = props;\n\n  const [interaction, dispatch] = useReducer(interactionReducer<T>, { value: null } as DragHandleInteractionState<T>);\n  useStateLogger(interaction, options.debug);\n  useCallbackHandler(interaction.transitionCallbacks, propsRef.current, dispatch);\n  return {\n    interaction,\n    processPointerDown: (event: PointerEvent, metadata?: T) => {\n      dispatch({\n        type: 'POINTER_DOWN',\n        payload: { nativeEvent: event, metadata },\n      });\n    },\n    processPointerMove: (event: PointerEvent) => {\n      dispatch({\n        type: 'POINTER_MOVE',\n        payload: { nativeEvent: event },\n      });\n    },\n    processPointerUp: (event: PointerEvent) => {\n      dispatch({\n        type: 'POINTER_UP',\n        payload: { nativeEvent: event },\n      });\n    },\n    processPointerCancel: () => {\n      dispatch({\n        type: 'POINTER_CANCEL',\n      });\n    },\n    processKeyDown: (event: React.KeyboardEvent<Element>, metadata?: T) => {\n      const key = event.key;\n      if (key === 'Enter' || key === 'Escape' || key === ' ') {\n        dispatch({\n          type: 'KEY_DOWN',\n          payload: { key, metadata },\n        });\n      }\n    },\n    processFocus: () => {\n      dispatch({ type: 'FOCUS' });\n    },\n    processBlur: () => {\n      dispatch({ type: 'BLUR' });\n    },\n  };\n}\n"]}