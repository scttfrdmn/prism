{"version":3,"file":"multi-layout.js","sourceRoot":"","sources":["../../../../../src/app-layout/visual-refresh-toolbar/skeleton/multi-layout.ts"],"names":[],"mappings":"AAAA,qEAAqE;AACrE,sCAAsC;AACtC,OAAO,EAAE,SAAS,EAAE,eAAe,EAAE,QAAQ,EAAE,MAAM,OAAO,CAAC;AAE7D,OAAO,EAAE,OAAO,EAAE,MAAM,2BAA2B,CAAC;AACpD,OAAO,EAAE,oBAAoB,EAAE,MAAM,+BAA+B,CAAC;AAErE,OAAO,EAAE,uBAAuB,EAAE,MAAM,2BAA2B,CAAC;AAMpE,MAAM,UAAU,iBAAiB,CAC/B,sBAAyC,EACzC,SAAkB,EAClB,KAAkB,EAClB,UAAsB;IAEtB,MAAM,CAAC,YAAY,EAAE,eAAe,CAAC,GAAG,QAAQ,CAAwC,IAAI,CAAC,CAAC;IAC9F,MAAM,SAAS,GAAG,uBAAuB,EAAE,CAAC;IAE5C,eAAe,CAAC,GAAG,EAAE;QACnB,IAAI,CAAC,SAAS,IAAI,sBAAsB,KAAK,WAAW,IAAI,CAAC,SAAS,EAAE;YACtE,OAAO;SACR;QACD,IAAI,sBAAsB,KAAK,KAAK,EAAE;YACpC,eAAe,CAAC,EAAE,IAAI,EAAE,SAAS,EAAE,eAAe,EAAE,EAAE,EAAE,CAAC,CAAC;YAC1D,OAAO;SACR;QACD,MAAM,UAAU,GAAG,oBAAoB,CAAC,eAAe,CAAC,QAAQ,CAAC,sBAAsB,EAAE,KAAK,CAAC,EAAE,CAC/F,eAAe,CAAC,KAAuC,CAAC,CACzD,CAAC;QACF,OAAO,GAAG,EAAE;YACV,UAAU,EAAE,CAAC;YACb,eAAe,CAAC,EAAE,IAAI,EAAE,WAAW,EAAE,CAAC,CAAC;QACzC,CAAC,CAAC;IACJ,CAAC,EAAE,CAAC,sBAAsB,EAAE,SAAS,EAAE,SAAS,CAAC,CAAC,CAAC;IAEnD,eAAe,CAAC,GAAG,EAAE;QACnB,IAAI,CAAA,YAAY,aAAZ,YAAY,uBAAZ,YAAY,CAAE,IAAI,MAAK,WAAW,EAAE;YACtC,YAAY,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;SAC5B;IACH,CAAC,CAAC,CAAC;IAEH,SAAS,CAAC,GAAG,EAAE;QACb,IAAI,YAAY,EAAE;YAChB,uBAAuB,CAAC,YAAY,CAAC,CAAC;SACvC;IACH,CAAC,EAAE,CAAC,YAAY,CAAC,CAAC,CAAC;IAEnB,IAAI,CAAC,SAAS,EAAE;QACd,OAAO;YACL,UAAU,EAAE,IAAI;YAChB,2FAA2F;YAC3F,+DAA+D;YAC/D,YAAY,EAAE,UAAU,CAAC,KAAK,EAAE,EAAE,CAAC;SACpC,CAAC;KACH;IAED,OAAO;QACL,UAAU,EAAE,CAAC,CAAC,CAAA,YAAY,aAAZ,YAAY,uBAAZ,YAAY,CAAE,IAAI,CAAA;QAChC,YAAY,EAAE,CAAA,YAAY,aAAZ,YAAY,uBAAZ,YAAY,CAAE,IAAI,MAAK,SAAS,CAAC,CAAC,CAAC,UAAU,CAAC,KAAK,EAAE,YAAY,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,IAAI;KACxG,CAAC;AACJ,CAAC;AAED,SAAS,uBAAuB,CAAC,YAA4C;IAC3E,IAAI,YAAY,CAAC,IAAI,KAAK,SAAS,IAAI,YAAY,CAAC,eAAe,CAAC,MAAM,GAAG,CAAC,EAAE;QAC9E,OAAO,CAAC,mBAAmB,CAAC,kCAAkC,EAAE;YAC9D,2CAA2C;YAC3C,kEAAkE;YAClE,cAAc,EAAE,YAAY,CAAC,eAAe,CAAC,MAAa;SAC3D,CAAC,CAAC;KACJ;SAAM,IAAI,YAAY,CAAC,IAAI,KAAK,WAAW,EAAE;QAC5C,OAAO,CAAC,mBAAmB,CAAC,oCAAoC,EAAE,EAAE,CAAC,CAAC;KACvE;AACH,CAAC","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { useEffect, useLayoutEffect, useState } from 'react';\n\nimport { metrics } from '../../../internal/metrics';\nimport { awsuiPluginsInternal } from '../../../internal/plugins/api';\nimport { RegistrationState } from '../../../internal/plugins/controllers/app-layout-widget';\nimport { useAppLayoutFlagEnabled } from '../../utils/feature-flags';\nimport { MergeProps, SharedProps } from '../state/interfaces';\nimport { ToolbarProps } from '../toolbar';\n\nexport type DeduplicationType = 'primary' | 'secondary' | 'suspended' | 'off';\n\nexport function useMultiAppLayout(\n  forceDeduplicationType: DeduplicationType,\n  isEnabled: boolean,\n  props: SharedProps,\n  mergeProps: MergeProps\n): { registered: boolean; toolbarProps: ToolbarProps | null } {\n  const [registration, setRegistration] = useState<RegistrationState<SharedProps> | null>(null);\n  const isToolbar = useAppLayoutFlagEnabled();\n\n  useLayoutEffect(() => {\n    if (!isEnabled || forceDeduplicationType === 'suspended' || !isToolbar) {\n      return;\n    }\n    if (forceDeduplicationType === 'off') {\n      setRegistration({ type: 'primary', discoveredProps: [] });\n      return;\n    }\n    const unregister = awsuiPluginsInternal.appLayoutWidget.register(forceDeduplicationType, props =>\n      setRegistration(props as RegistrationState<SharedProps>)\n    );\n    return () => {\n      unregister();\n      setRegistration({ type: 'suspended' });\n    };\n  }, [forceDeduplicationType, isEnabled, isToolbar]);\n\n  useLayoutEffect(() => {\n    if (registration?.type === 'secondary') {\n      registration.update(props);\n    }\n  });\n\n  useEffect(() => {\n    if (registration) {\n      reportMultiLayoutMetric(registration);\n    }\n  }, [registration]);\n\n  if (!isToolbar) {\n    return {\n      registered: true,\n      // mergeProps is needed here because the toolbar's behavior depends on reconciliation logic\n      // in this function. For example, navigation trigger visibility\n      toolbarProps: mergeProps(props, []),\n    };\n  }\n\n  return {\n    registered: !!registration?.type,\n    toolbarProps: registration?.type === 'primary' ? mergeProps(props, registration.discoveredProps) : null,\n  };\n}\n\nfunction reportMultiLayoutMetric(registration: RegistrationState<SharedProps>) {\n  if (registration.type === 'primary' && registration.discoveredProps.length > 0) {\n    metrics.sendOpsMetricObject('awsui-multi-layout-usage-primary', {\n      // temporary workaround for missing typings\n      // https://github.com/cloudscape-design/component-toolkit/pull/153\n      instancesCount: registration.discoveredProps.length as any,\n    });\n  } else if (registration.type === 'suspended') {\n    metrics.sendOpsMetricObject('awsui-multi-layout-usage-suspended', {});\n  }\n}\n"]}